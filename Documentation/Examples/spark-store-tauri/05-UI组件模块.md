# 05 - UI ç»„ä»¶æ¨¡å—

## æ¨¡å—æ¦‚è§ˆ

### æ–‡ä»¶ä½ç½®

- `src/components/` - ä¸šåŠ¡ç»„ä»¶
- `src/components/ui/` - åŸºç¡€ UI ç»„ä»¶åº“

### åŠŸèƒ½èŒè´£

UI ç»„ä»¶æ¨¡å—è´Ÿè´£ï¼š
- æä¾›å¯å¤ç”¨çš„åŸºç¡€ UI ç»„ä»¶
- å®ç°ä¸šåŠ¡ç›¸å…³çš„å¤åˆç»„ä»¶
- ç»Ÿä¸€çš„è®¾è®¡ç³»ç»Ÿå’Œæ ·å¼è§„èŒƒ

### æ¨¡å—å…³ç³»å›¾

```mermaid
graph TB
    subgraph UI["åŸºç¡€ UI ç»„ä»¶ (ui/)"]
        Button[button.tsx]
        Card[card.tsx]
        Dialog[dialog.tsx]
        Input[input.tsx]
        Progress[progress.tsx]
        Sidebar[sidebar.tsx]
        Skeleton[skeleton.tsx]
        Tabs[tabs.tsx]
        Toast[toast.tsx]
        Carousel[carousel.tsx]
    end
    
    subgraph Business["ä¸šåŠ¡ç»„ä»¶"]
        AppCard[AppCard/]
        AppList[AppList/]
        DownloadCard[DownloadCard/]
        HomeCarousel[HomeCarousel/]
        SidebarComp[Sidebar/]
        TitleBarComp[TitleBar/]
        ScreenshotCarousel[ScreenshotCarousel/]
    end
    
    Business --> UI
    AppList --> AppCard
    HomeCarousel --> Carousel
    DownloadCard --> Progress
    DownloadCard --> Button
```

## åŸºç¡€ UI ç»„ä»¶åº“

é¡¹ç›®ä½¿ç”¨ [Kobalte](https://kobalte.dev/) ä½œä¸ºæ— éšœç¢ç»„ä»¶åº“åŸºç¡€ï¼Œç»“åˆ TailwindCSS å®ç°è®¾è®¡ç³»ç»Ÿã€‚

### ç»„ä»¶åˆ—è¡¨

| ç»„ä»¶ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| Button | `button.tsx` | æŒ‰é’®ç»„ä»¶ |
| Card | `card.tsx` | å¡ç‰‡ç»„ä»¶ |
| Carousel | `carousel.tsx` | è½®æ’­ç»„ä»¶ |
| Checkbox | `checkbox.tsx` | å¤é€‰æ¡† |
| Dialog | `dialog.tsx` | å¯¹è¯æ¡† |
| DropdownMenu | `dropdown-menu.tsx` | ä¸‹æ‹‰èœå• |
| Input | `input.tsx` | è¾“å…¥æ¡† |
| Label | `label.tsx` | æ ‡ç­¾ |
| Progress | `progress.tsx` | è¿›åº¦æ¡ |
| Separator | `separator.tsx` | åˆ†éš”çº¿ |
| Sheet | `sheet.tsx` | ä¾§è¾¹æŠ½å±‰ |
| Sidebar | `sidebar.tsx` | ä¾§è¾¹æ  |
| Skeleton | `skeleton.tsx` | éª¨æ¶å± |
| Tabs | `tabs.tsx` | æ ‡ç­¾é¡µ |
| TextField | `text-field.tsx` | æ–‡æœ¬è¾“å…¥ |
| Toast | `toast.tsx` | æ¶ˆæ¯æç¤º |
| Tooltip | `tooltip.tsx` | å·¥å…·æç¤º |

## ä¸šåŠ¡ç»„ä»¶

### AppCard - åº”ç”¨å¡ç‰‡

```typescript
// æ–‡ä»¶è·¯å¾„: src/components/AppCard/index.tsx
import { Component } from 'solid-js';
import { A } from '@solidjs/router';

export interface AppCardProps {
  category: string;     // åˆ†ç±» ID
  pkgname: string;      // åŒ…å
  name: string;         // åº”ç”¨åç§°
  description: string;  // æè¿°
  icon?: string;        // å›¾æ ‡ URL
}

const AppCard: Component<AppCardProps> = (props) => {
  return (
    <A
      href={`/app/${props.category}/${props.pkgname}`}
      class="block p-4 rounded-lg border border-border bg-card hover:border-primary/50 transition-colors"
    >
      <div class="flex items-center gap-3 h-full">
        <div class="w-12 h-12 rounded-lg bg-muted flex items-center justify-center overflow-hidden">
          {props.icon ? (
            <img src={props.icon} alt={props.name} class="w-full h-full object-cover" />
          ) : (
            <div class="text-2xl font-bold text-muted-foreground">
              {props.name.charAt(0)}
            </div>
          )}
        </div>
        <div class="flex-1 min-w-0">
          <h3 class="font-medium text-base truncate">{props.name}</h3>
          <p class="mt-1 text-sm text-muted-foreground line-clamp-2">
            {props.description}
          </p>
        </div>
      </div>
    </A>
  );
};
```

#### ç»„ä»¶ç»“æ„

```mermaid
classDiagram
    class AppCard {
        +string category
        +string pkgname
        +string name
        +string description
        +string? icon
    }
    
    class Link {
        <<A component>>
        +href: /app/category/pkgname
    }
    
    class IconContainer {
        +w-12 h-12
        +rounded-lg
    }
    
    class TextContainer {
        +flex-1
        +min-w-0
    }
    
    AppCard --> Link
    Link --> IconContainer
    Link --> TextContainer
```

### AppList - åº”ç”¨åˆ—è¡¨

```typescript
// æ–‡ä»¶è·¯å¾„: src/components/AppList/index.tsx
import { Component, For } from 'solid-js';
import { AppItem } from '@/types/app';
import AppCard from '../AppCard';
import { Skeleton } from "@/components/ui/skeleton";

interface AppListProps {
  apps: AppItem[];      // åº”ç”¨åˆ—è¡¨
  loading: boolean;     // åŠ è½½çŠ¶æ€
  category?: string;    // é»˜è®¤åˆ†ç±»
}

const AppList: Component<AppListProps> = (props) => {
  return (
    <div class="grid auto-rows-auto grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-4 pb-6">
      {props.loading ? (
        // éª¨æ¶å±
        <For each={Array(8).fill(0)}>
          {() => (
            <div class="p-4 rounded-lg border border-border/40 bg-card">
              <div class="flex items-start gap-3">
                <Skeleton width={48} height={48} radius={8} />
                <div class="flex-1 min-w-0">
                  <Skeleton height={20} width={96} />
                  <Skeleton height={16} width={100} class="mt-2" />
                </div>
              </div>
            </div>
          )}
        </For>
      ) : (
        // å®é™…åˆ—è¡¨
        <For each={props.apps}>
          {(app) => (
            <AppCard
              category={props.category || app.category || ''}
              pkgname={app.pkgname}
              name={app.name}
              description={app.more}
              icon={app.icon}
            />
          )}
        </For>
      )}
    </div>
  );
};
```

#### å“åº”å¼ç½‘æ ¼å¸ƒå±€

| å±å¹•å®½åº¦ | åˆ—æ•° | è¯´æ˜ |
|----------|------|------|
| < 400px | 1 åˆ— | è¶…å°å±å¹• |
| 400-600px | 2 åˆ— | å°å±å¹• |
| 600-800px | 3 åˆ— | ä¸­ç­‰å±å¹• |
| 800-1000px | 4 åˆ— | å¤§å±å¹• |
| > 1000px | 5+ åˆ— | è¶…å¤§å±å¹• |

### DownloadCard - ä¸‹è½½å¡ç‰‡

```typescript
// æ–‡ä»¶è·¯å¾„: src/components/DownloadCard/index.tsx
import { Component } from 'solid-js';
import { Progress } from '@/components/ui/progress';
import { Button } from '@/components/ui/button';
import { Pause, Play, X } from 'lucide-solid';
import { DownloadTask } from '@/types/download';

const DownloadCard: Component<{ download: DownloadTask }> = (props) => {
  const { pauseDownload, resumeDownload, cancelDownload } = useDownloadsStore();

  return (
    <div class="flex items-center gap-3 p-4 bg-card rounded-lg border border-border/40">
      <img src={props.download.icon} alt={props.download.name} class="w-12 h-12 rounded-lg" />
      <div class="flex-1">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-medium">{props.download.name}</h3>
          <div class="text-sm text-muted-foreground">
            {/* çŠ¶æ€æ˜¾ç¤º */}
          </div>
        </div>
        <div class="flex items-center gap-2">
          <Progress 
            value={props.download.status === 'installed' ? 100 : props.download.progress} 
            indeterminate={props.download.status === 'installing'}
          />
          <span class="text-sm">{props.download.progress}%</span>
          {/* æ“ä½œæŒ‰é’® */}
        </div>
      </div>
    </div>
  );
};
```

#### çŠ¶æ€æ˜¾ç¤ºé€»è¾‘

```mermaid
flowchart TD
    A[æ¸²æŸ“ DownloadCard] --> B{æ£€æŸ¥çŠ¶æ€}
    B -->|queued| C[æ˜¾ç¤º: æ’é˜Ÿä¸­]
    B -->|downloading| D[æ˜¾ç¤º: é€Ÿåº¦ + å¤§å°]
    B -->|paused| E[æ˜¾ç¤º: å·²æš‚åœ]
    B -->|error| F[æ˜¾ç¤º: å¤±è´¥]
    B -->|installing| G[æ˜¾ç¤º: æ­£åœ¨å®‰è£…]
    B -->|installed| H[æ˜¾ç¤º: å®‰è£…å®Œæˆ]
    
    B --> I{æŒ‰é’®æ˜¾ç¤º}
    I -->|downloading/queued| J[æ˜¾ç¤ºæš‚åœæŒ‰é’®]
    I -->|paused| K[æ˜¾ç¤ºæ¢å¤æŒ‰é’®]
    I -->|æ‰€æœ‰çŠ¶æ€| L[æ˜¾ç¤ºå–æ¶ˆæŒ‰é’®]
```

### HomeCarousel - é¦–é¡µè½®æ’­

```typescript
// æ–‡ä»¶è·¯å¾„: src/components/HomeCarousel/index.tsx
import { Component } from 'solid-js';
import BaseCarousel from "@/components/ui/base-carousel";
import { HomeLink } from '@/types/home';

interface HomeCarouselProps {
  slides?: HomeLink[];
  loading?: boolean;
  class?: string;
}

const HomeCarousel: Component<HomeCarouselProps> = (props) => {
  const renderItem = (slide: HomeLink) => (
    <a 
      href={slide.linkUrl}
      target="_blank"
      class="text-center w-full h-[120px] relative bg-cover bg-center bg-no-repeat block" 
      style={{"background-image": `url(${slide.imgUrl})`}}
    >
      <div class="absolute inset-0 bg-black/50" />
      <div class="relative z-10 p-4 flex flex-col justify-center h-full">
        <h3 class="text-xl font-semibold mb-2 text-white">{slide.name}</h3>
        <p class="text-sm text-gray-200">{slide.more}</p>
      </div>
    </a>
  );

  return (
    <BaseCarousel
      items={props.slides}
      loading={props.loading}
      renderItem={renderItem}
    />
  );
};
```

### Sidebar - ä¾§è¾¹æ 

```typescript
// æ–‡ä»¶è·¯å¾„: src/components/Sidebar/index.tsx
import { Component, For } from 'solid-js';
import { A } from '@solidjs/router';
import { Compass, Heart, Download, RefreshCw, Settings } from 'lucide-solid';

const menuItems = [
  { title: 'æ¢ç´¢å‘ç°', url: '/', icon: () => <Compass size={20} /> },
  { title: 'æˆ‘çš„æ”¶è—', url: '/collections', icon: () => <Heart size={20} /> },
  { title: 'ä¸‹è½½åˆ—è¡¨', url: '/downloads', icon: () => <Download size={20} /> }
];

const footerItems = [
  { title: 'æ£€æŸ¥æ›´æ–°', url: '/update', icon: () => <RefreshCw size={20} /> },
  { title: 'åº”ç”¨è®¾ç½®', url: '/settings', icon: () => <Settings size={20} /> }
];

const AppSidebar: Component = () => {
  const { categories } = useCategoriesStore();

  return (
    <Sidebar>
      <SidebarContent>
        <SidebarGroup>
          <SidebarGroupLabel>Spark Store</SidebarGroupLabel>
          <SidebarGroupContent>
            <SidebarMenu>
              <For each={menuItems}>
                {(item) => (
                  <SidebarMenuItem>
                    <SidebarMenuButton as={A} href={item.url}>
                      {item.icon()}
                      <span>{item.title}</span>
                    </SidebarMenuButton>
                  </SidebarMenuItem>
                )}
              </For>
            </SidebarMenu>
          </SidebarGroupContent>
          
          <SidebarGroupLabel>åº”ç”¨åˆ†ç±»</SidebarGroupLabel>
          <SidebarGroupContent>
            <SidebarMenu>
              <For each={categories()}>
                {(category) => (
                  <SidebarMenuItem>
                    <SidebarMenuButton as={A} href={`/categories/${category.id}`}>
                      {getIconComponent(category.icon)({ size: 20 })}
                      <span>{category.name_zh_cn}</span>
                    </SidebarMenuButton>
                  </SidebarMenuItem>
                )}
              </For>
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>
      </SidebarContent>
      <SidebarRail />
    </Sidebar>
  );
};
```

#### ä¾§è¾¹æ ç»“æ„

```mermaid
graph TB
    subgraph Sidebar["Sidebar ç»„ä»¶"]
        Content[SidebarContent]
        Rail[SidebarRail]
    end
    
    subgraph Groups["åˆ†ç»„"]
        MainGroup[ä¸»èœå•]
        CategoryGroup[åº”ç”¨åˆ†ç±»]
        FooterGroup[é«˜çº§é€‰é¡¹]
    end
    
    subgraph Items["èœå•é¡¹"]
        Explore[æ¢ç´¢å‘ç°]
        Collections[æˆ‘çš„æ”¶è—]
        Downloads[ä¸‹è½½åˆ—è¡¨]
        Categories[åŠ¨æ€åˆ†ç±»åˆ—è¡¨]
        Update[æ£€æŸ¥æ›´æ–°]
        Settings[åº”ç”¨è®¾ç½®]
    end
    
    Content --> MainGroup
    Content --> CategoryGroup
    Content --> FooterGroup
    
    MainGroup --> Explore
    MainGroup --> Collections
    MainGroup --> Downloads
    CategoryGroup --> Categories
    FooterGroup --> Update
    FooterGroup --> Settings
```

### TitleBar - æ ‡é¢˜æ 

```typescript
// æ–‡ä»¶è·¯å¾„: src/components/TitleBar/index.tsx
import { Component, Show } from "solid-js";
import { Maximize2, Minus, X, ArrowLeft, RotateCw, Search } from "lucide-solid";
import { Button } from "@/components/ui/button";
import { SidebarTrigger } from "../ui/sidebar";

interface TitleBarProps {
  onRefresh?: () => void;
  isSidebarOpen?: boolean;
}

const TitleBar: Component<TitleBarProps> = (props) => {
  const { goBack, canGoBack, refresh } = useTitleBarStore();
  const navigate = useNavigate();
  
  const handleSearch = () => {
    if (searchInput?.value) {
      if (searchInput.value.startsWith('spk://')) {
        // å¤„ç† SPK åè®®
        const path = searchInput.value.replace('spk://', '');
        const parts = path.split('/');
        navigate(`/app/${parts[parts.length - 2]}/${parts[parts.length - 1]}`);
      } else {
        navigate(`/search?q=${encodeURIComponent(searchInput.value)}`);
      }
    }
  };

  return (
    <div class="h-12 border-b flex items-center justify-between px-2 bg-background fixed top-0 right-0 z-50">
      <div class="flex items-center gap-2">
        <SidebarTrigger />
        <Show when={canGoBack()}>
          <Button variant="ghost" size="icon" onClick={goBack}>
            <ArrowLeft size={16} />
          </Button>
        </Show>
        <Button variant="ghost" size="icon" onClick={() => refresh(props.onRefresh)}>
          <RotateCw size={16} />
        </Button>
        <TextField>
          <TextFieldInput placeholder="æœç´¢åº”ç”¨..." onKeyPress={handleKeyPress} />
        </TextField>
        <Button variant="ghost" size="icon" onClick={handleSearch}>
          <Search size={16} />
        </Button>
      </div>
      <div class="flex items-center gap-2">
        <Button variant="ghost"><Minus size={16} /></Button>
        <Button variant="ghost"><Maximize2 size={16} /></Button>
        <Button variant="ghost"><X size={16} /></Button>
      </div>
    </div>
  );
};
```

#### æ ‡é¢˜æ å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‰¡ â”‚ â† â”‚ â†» â”‚ [     æœç´¢åº”ç”¨...     ] â”‚ ğŸ” â”‚     â”‚ â€” â”‚ â–¡ â”‚ Ã— â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†‘    â†‘    â†‘           â†‘               â†‘           â†‘   â†‘   â†‘
ä¾§è¾¹æ  è¿”å› åˆ·æ–°      æœç´¢æ¡†           æœç´¢        æœ€å°åŒ– æœ€å¤§åŒ– å…³é—­
```

## ç»„ä»¶è®¾è®¡è§„èŒƒ

### æ ·å¼ç±»å‘½å

é¡¹ç›®ä½¿ç”¨ TailwindCSS + CSS å˜é‡çš„è®¾è®¡ç³»ç»Ÿï¼š

| ç±»åˆ« | CSS å˜é‡ | è¯´æ˜ |
|------|----------|------|
| èƒŒæ™¯ | `--background` | ä¸»èƒŒæ™¯è‰² |
| å‰æ™¯ | `--foreground` | ä¸»æ–‡å­—è‰² |
| å¡ç‰‡ | `--card` | å¡ç‰‡èƒŒæ™¯ |
| è¾¹æ¡† | `--border` | è¾¹æ¡†è‰² |
| ä¸»è‰² | `--primary` | ä¸»é¢˜è‰² |
| æ¬¡è¦ | `--secondary` | æ¬¡è¦è‰² |
| é™éŸ³ | `--muted` | å¼±åŒ–è‰² |
| å¼ºè°ƒ | `--accent` | å¼ºè°ƒè‰² |

### ç»„ä»¶ Props è§„èŒƒ

```typescript
// é€šç”¨ Props æ¨¡å¼
interface ComponentProps {
  class?: string;        // å¤–éƒ¨æ ·å¼ç±»
  children?: JSX.Element; // å­å…ƒç´ 
  loading?: boolean;     // åŠ è½½çŠ¶æ€
  disabled?: boolean;    // ç¦ç”¨çŠ¶æ€
  // ... ä¸šåŠ¡ Props
}
```

---

[ä¸Šä¸€ç¯‡: 04-æ•°æ®ç±»å‹å®šä¹‰](04-æ•°æ®ç±»å‹å®šä¹‰.md) | [è¿”å›ç›®å½•](README.md) | [ä¸‹ä¸€ç¯‡: 06-é¡µé¢åŠŸèƒ½æ¨¡å—](06-é¡µé¢åŠŸèƒ½æ¨¡å—.md)
